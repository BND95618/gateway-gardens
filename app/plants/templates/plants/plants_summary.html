<!-- /app/plants/templates/plants/plants_summary.html -->
{% extends "plants/master.html" %}

<!--  -->
{% load user_tags %}

{% block title %}
  <title>Plant | Search</title>
{% endblock title %}

{% block css %}
<!-- Insert template css here -->
<style>
  #plants_summary   { background-color: slategray; }
  #plants_summary a { color:            white; }
</style>
{% endblock css %}

{% block header-completion %}
  <!-- complete the header from master.html -->
  <header class="bnd-page-banner">
    <h3>
      Plant Finder
      <span class="bnd-dropdown-container">
        <button class="bnd-button-small">
          <i class="material-icons">menu</i>
        </button>
        <div class="bnd-dropdown-content">
          <button onclick="searchOpen()"     class="bnd-dropdown-button">Plant Search  </button>
          <button onclick="column_chooser()" class="bnd-dropdown-button">Column Chooser</button>
          <button onclick="plants_chart()"   class="bnd-dropdown-button">Bloom Charts  </button>
          {% if perms.plants.add_plant %}
            <a href="{% url 'plants:plant_add' %}" class="bnd-dropdown-button">Add Plant</a>
          {% endif %}
        </div>
      </span>
    </h3>
  </header>
{% endblock header-completion %}

{% block content %}
  <!-------------------------------------------------------------------------->
  <!-- Vertical Search Bar                                                  -->
  <!-------------------------------------------------------------------------->
  <div id="bnd-search-sidebar" class="bnd-sidebar">
    <form method="POST" action="{% url 'plants:plants_summary' %}" class="bnd-sidebar-contents">
      {% csrf_token %}
      <!-- Plant Attributes -->
      <p class="bnd-center"><i>Plant Details</i></p>

      <label for="id_type_x_search">Type:</label><br>
      <select id="id_type_x_search" name="type_x_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for plant_type in plant_types %}
          {% if plant_type == type_x_search %}
            <option value="{{ plant_type }}" selected>{{ plant_type }}</option>
          {% elif plant_type != "tbd" %}
            <option value="{{ plant_type }}"         >{{ plant_type }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_bloom_color_search">Bloom Color:</label><br>
      <select id="id_bloom_color_search" name="bloom_color_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in bloom_color_opt %}
          {% if x == bloom_color_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_bloom_season_search">Bloom Season:</label><br>
      <select id="id_bloom_season_search" name="bloom_season_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in bloom_season_opt %}
          {% if x == bloom_season_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_bloom_month_search">Bloom Month:</label><br>
      <select id="id_bloom_month_search" name="bloom_month_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for month in month_opt %}
          {% if month == bloom_month_search %}
            <option value="{{ month }}" selected>{{ month }}</option>
          {% elif plant_type != "tbd" %}
            <option value="{{ month }}"         >{{ month }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_pollinators_search">Pollinators:</label><br>
      <select id="id_pollinators_search" name="pollinators_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in pollinators_opt %}
          {% if x == pollinators_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_ca_native_search">California Native:</label><br>
      <select id="id_ca_native_search" name="ca_native_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in ca_native_opt %}
          {% if x == ca_native_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_ucd_all_star_search">UCD All-Star:</label><br>
      <select id="id_ucd_all_star_search" name="ucd_all_star_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in ucd_all_star_opt %}
          {% if x == ucd_all_star_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_davis_trees_search">Davis Climate-Ready Trees:</label><br>
      <select id="id_davis_trees_search" name="davis_trees_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in davis_trees_opt %}
          {% if x == davis_trees_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_sunset_z14_search">Sunset Z14:</label><br>
      <select id="id_sunset_z14_search" name="sunset_z14_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in sunset_z14_opt %}
          {% if x == sunset_z14_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <!-- Environmental Needs -->
      <p class="bnd-center"><i>Environmental Needs</i></p>

      <label for="id_sun_exposure_search">Sun Exposure:</label><br>
      <select id="id_sun_exposure_search" name="sun_exposure_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in sun_exposure_opt %}
          {% if x == sun_exposure_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_water_rqmts_search">Water Requirements:</label><br>
      <select id="id_water_rqmts_search" name="water_rqmts_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in water_rqmts_opt %}
          {% if x == water_rqmts_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_soil_type_search">Soil Requirements:</label><br>
      <select id="id_soil_type_search" name="soil_type_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in soil_type_opt %}
          {% if x == soil_type_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_pH_search">pH:</label><br>
      <select id="id_pH_search" name="pH_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in pH_opt %}
          {% if x == pH_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>
      
      <label for="id_heat_tolerance_search">Heat Tolerance:</label><br>
      <select id="id_heat_tolerance_search" name="heat_tolerance_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in heat_tolerance_opt %}
          {% if x == heat_tolerance_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_usda_zone_search">USDA Zone:</label><br>
      <select id="id_usda_zone_search" name="usda_zone_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in usda_zones_opt %}
          {% if x == usda_zone_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>

      <label for="id_sunset_zone_search">Sunset Zone:</label><br>
      <select id="id_sunset_zone_search" name="sunset_zone_search" class="bnd-select">
        <option value="Any" >Any</option>
        {% for x in sunset_zones_opt %}
          {% if x == sunset_zone_search %}
            <option value="{{ x }}" selected>{{ x }}</option>
          {% elif x != "tbd" %}
            <option value="{{ x }}"         >{{ x }}</option>
          {% endif %}
        {% endfor %}
      </select>
      <br>
      <!-- In My Garden? -->
      <p class="bnd-center"><i>In My Garden?</i></p>

      <label for="id_garden_search">All plants / My plants</label><br>
      <select id="id_garden_search" name="garden_search" class="bnd-select">
        {% if garden_search == "Any" %}
          <option value="Any"  selected>Any </option>
          <option value="Mine"         >Mine</option>
        {% else %}
          <option value="Any"          >Any </option>
          <option value="Mine" selected>Mine</option>
        {% endif %}
      </select>
      <br>

      <!-- Admin stuff - Display for group = "Garden-Editor" -->
      {% if request.user|has_group:"Garden-Editor" %}
        <div>
      {% elif request.user|has_group:"Gardener" %}
        <div style = "display: none">
      {% endif %}

        <!-- Admin stuff -->
        <p class="bnd-center"><i>Admin stuff</i></p>
        
        <label for="id_status_search">Status:</label><br>
        <select id="id_status_search" name="status_search" class="bnd-select">
          <option value="Any" >Any</option>
          {% for x in status_opt %}
            {% if x == status_search %}
              <option value="{{ x }}" selected>{{ x }}</option>
            {% elif x != "tbd" %}
              <option value="{{ x }}"         >{{ x }}</option>
            {% endif %}
          {% endfor %}
        </select>
        <br>

      </div>

      <footer class="bnd-modal-button-bar">
        <!-- Button to initiate the search based upon the input criteria -->
        <button type="submit" value="Submit" class="bnd-button-submit">Submit</button>
        <!-- Button to reset all search criteria to 'Any' -->
        <button type="button" 
                onclick="searchReset()"
                value="Reset" 
                class="bnd-button bnd-border bnd-white bnd-round-large">
          Reset
        </button>
        <!-- Button to hide the search menu -->
        <button type="button" onclick="searchClose()" value="Hide" class="bnd-button-cancel">Hide</button>
      </footer>
    </form>
  </div>
  <!-------------------------------------------------------------------------->
  <!-- Plant Table                                                          -->
  <!-------------------------------------------------------------------------->
  <div id="main" class="bnd-content-main-100">
    <table id="plantTable" class="bnd-table">
      <thead>
        <tr>
          <!-- Plant Attributes -->
          <th onclick="sortTable( 0, 'plantTable')" >Common Name     </th>
          <th onclick="sortTable( 1, 'plantTable')" >Genus/Species   </th>
          <th onclick="sortTable( 2, 'plantTable')" >Variety/Cultivar</th>
          <th onclick="sortTable( 3, 'plantTable')" >Type            </th>
          <th onclick="sortTable( 4, 'plantTable')" >Height          </th>
          <th onclick="sortTable( 5, 'plantTable')" >Width           </th>
          <th onclick="sortTable( 6, 'plantTable')" >Bloom Color     </th>
          <th onclick="sortTable( 7, 'plantTable')" >Bloom Season    </th>
          <th onclick="sortTable( 8, 'plantTable')" >Bloom Range     </th>
          <th onclick="sortTable( 9, 'plantTable')" >Pollinators     </th>
          <th onclick="sortTable(10, 'plantTable')" class="bnd-center">CA Native</th>
          <th onclick="sortTable(11, 'plantTable')" class="bnd-center">UCD All-Star</th>
          <th onclick="sortTable(12, 'plantTable')" class="bnd-center">Davis trees</th>
          <th onclick="sortTable(13, 'plantTable')" class="bnd-center">Sunset Z14</th>
          <!-- Plant Requirements -->
          <th onclick="sortTable(14, 'plantTable')">Sun Exposure   </th>
          <th onclick="sortTable(15, 'plantTable')">Water Rqmts    </th>
          <th onclick="sortTable(16, 'plantTable')">Soil Type      </th>
          <th onclick="sortTable(17, 'plantTable')">pH Range       </th>
          <th onclick="sortTable(18, 'plantTable')">Heat Tolerance </th>
          <th onclick="sortTable(19, 'plantTable')">USDA Zones     </th>
          <th onclick="sortTable(20, 'plantTable')">Sunset Zones   </th>
          <th onclick="sortTable(21, 'plantTable')">Status         </th>
          <!-- Plant Detail header placeholder -->
          <th class="bnd-center"></th>
          <!-- Plant Update header placeholder -->
          {% if perms.plants.change_plant %}
            <th class="bnd-center"></th>
          {% endif %}
          <!-- Plant Delete header placeholder -->
          {% if perms.plants.delete_plant %}
            <th class="bnd-center"></th>
          {% endif %}
          <!-- My plant add/remove header placeholder -->
          <th class="bnd-center"></th>
        </tr>
      </thead>
      {% for plant in plants %}
        {% if plant.plant_show == "yes" %}   
          <tr>
            <!-- Plant Attributes -->
            <td>{{ plant.commonName                     }}</td>
            <td>{{ plant.genus }} {{ plant.species}}      </td>
            {% if plant.variety != "n/a" and plant.variety != "tbd" %}
              <td class="bnd-variety">{{ plant.variety}}</td>
            {% elif plant.cultivar != "n/a" and plant.cultivar != "tbd" %}
              <td class="bnd-cultivar">'{{ plant.cultivar}}'</td>
            {% else %}
              <td>---</td>
            {% endif %}
            <td>{{ plant.type_x                         }}</td>
            <td>{{ plant.height_feet }} ft {{ plant.height_inch }} in</td>
            <td>{{ plant.width_feet  }} ft {{ plant.width_inch  }} in</td>
            <td>{{ plant.bloom_color |cut:"["|cut:"]"   }}</td>
            <td>{{ plant.bloom_season|cut:"["|cut:"]"   }}</td>
            <td>{{ plant.bloom_start }}-{{ plant.bloom_end }}</td>
            <td>{{ plant.pollinators |cut:"["|cut:"]"   }}</td>
            <td class="bnd-center">{{ plant.ca_native    }}</td>
            <td class="bnd-center">{{ plant.ucd_all_star }}</td>
            <td class="bnd-center">{{ plant.davis_trees  }}</td>
            <td class="bnd-center">{{ plant.sunset_z14   }}</td>
            <!-- Plant Requirements -->
            <td>{{ plant.sun_exposure|cut:"["|cut:"]"   }}</td>
            <td>{{ plant.water_rqmts                    }}</td>
            <td>{{ plant.soil_type                      }}</td>
            <td>{{ plant.pH_min }} to {{ plant.pH_max }}              </td>
            <td>{{ plant.heat_tolerance                             }}</td>
            <td>{{ plant.usda_zone_min }} to {{ plant.usda_zone_max }}</td>
            <td>{{ plant.sunset_zones }}                              </td>
            <!-- Admin -->
            <td>{{ plant.status }}                                    </td>
            <!-- Plant Details Icon/Link -->
            <td class="bnd-table-icon">
              <div class="bnd-tooltip">
                <a href="{% url 'plants:plant_details' plant.id %}">
                  <i    class="material-icons bnd-text-black">library_books</i>
                  <span class="bnd-tooltip-text">Details</span>
                </a>
              </div>
            </td>
            <!-- Plant Update Icon/Link -->
            {% if perms.plants.change_plant %}
            <td class="bnd-table-icon">
              <div class="bnd-tooltip">
                <a href="{% url 'plants:plant_edit' plant.id %}">
                  <i    class="material-icons bnd-text-black">edit</i>
                  <span class="bnd-tooltip-text">Edit</span>
                </a>
              </div>
            </td>
            {% endif %}
            <!-- Plant Delete Icon/Link -->
            {% if perms.plants.delete_plant %}
            <td class="bnd-table-icon">
              <div class="bnd-tooltip">
                <button onclick="plants_delete({{ plant.id }})" class="bnd-button-small">
                  <i    class="material-icons bnd-text-black">delete</i>
                  <span class="bnd-tooltip-text">Delete</span>
                </button>
              </div>
            </td>
            {% endif %}
            <!-- Add/remove plant to/from My Plants Icon/Link -->
            <td class="bnd-table-icon">
              <div class="bnd-tooltip">
                {% if plant.plant_mine == "yes" %}
                  <button onclick="myplant_remove({{ plant.id }})" class="bnd-button-small">
                    <i    class="material-icons bnd-text-black">check</i>
                    <span class="bnd-tooltip-text">MyPlant</span>
                  </button>
                {% else %}
                  <a href="{% url 'plants:myplants_add' plant.id %}">
                    <i    class="material-icons bnd-text-black">add</i>
                    <span class="bnd-tooltip-text">MyPlant</span>
                  </a>
                {% endif %}
              </div>
            </td>
          </tr>
        {% endif %}
      {% endfor %}
    </table>
  </div>
  <!-------------------------------------------------------------------------->
  <!-- Modals                                                               -->
  <!-------------------------------------------------------------------------->
  <!-- Plant Delete modal - html to be inserted by Javascript -->
  <div id="plants_delete_modal" class="bnd-modal">
    <p>Plant delete form HTML to be Inserted Here!</p>
  </div>

  <!-- My Plant Remove modal - html to be inserted by Javascript -->
  <div id="myplant_remove_modal" class="bnd-modal">
    <p>My Plant remove form HTML to be Inserted Here!</p>
  </div>
  
  <!-- Column Chooser modal - html to be inserted by Javascript -->
  <div id="column_chooser_modal" class="bnd-modal">
    <p>Column Chooser HTML to be Inserted Here!</p>
  </div>
  
  <!-- Plant Bloom Chart modal -->
  <div id="plants_chart_modal" class="bnd-modal">
    <div class="bnd-modal-content-1000" >
      <header class="bnd-modal-header bnd-margin-none">
        <h3>
          Bloom Chart - Blooms by Month
          <!-- Close the chart modal -->
          <span onclick="plants_chart_modal_close()" class="bnd-button bnd-modal-close">&times;</span>
        </h3>
        <!-- Create the modal tabs - each chart has a tab -->
        <div class="bnd-navbar">
          <button id="bloomTabButton"       class="tab bnd-navbar-item-left bnd-button">Blooms      </button>
          <button id="beeTabButton"         class="tab bnd-navbar-item-left bnd-button">Bees        </button>
          <button id="butterflyTabButton"   class="tab bnd-navbar-item-left bnd-button">Butterflies </button>
          <button id="hummingbirdTabButton" class="tab bnd-navbar-item-left bnd-button">Hummingbirds</button>
        </div>
      </header>
    
      <!-- Create the modal chart - Blooms -->
      <div id="bloomTabContent" class="tabContent">
        {% with table_name="bloomTable" %}
          <table id="bloomTable" class="bnd-table">
            {% include "plants/plants_chart_modal_head.html" %}
            {% for plant in plants %}
              {% if plant.plant_show == "yes" and plant.bloom_months != '' %} 
                {% include "plants/plants_chart_modal_rows.html" %}
              {% endif %}
            {% endfor %}
          </table>
          <footer class="bnd-modal-footer">
            <p>Garden Blooms</p>
          </footer>
        {% endwith %}
      </div>
    
      <!-- Create the modal chart - Bees -->
      <div id="beeTabContent" class="tabContent">
        {% with table_name="beeTable" %}
          <table id="beeTable" class="bnd-table">
            {% include "plants/plants_chart_modal_head.html" %}
            {% for plant in plants %}
              {% if plant.plant_show == "yes" and "Bees" in plant.pollinators and plant.bloom_months != '' %} 
                {% include "plants/plants_chart_modal_rows.html" %}
              {% endif %}
            {% endfor %}
          </table>
          <footer class="bnd-modal-footer">
            <p>Blooms attracting Bees</p>
          </footer>
        {% endwith %}
      </div>
    
      <!-- Create the modal chart - Butterflies -->
      <div id="butterflyTabContent" class="tabContent">
        {% with table_name="butterflyTable" %}
          <table id="butterflyTable" class="bnd-table">
            {% include "plants/plants_chart_modal_head.html" %}
            {% for plant in plants %}
              {% if plant.plant_show == "yes" and "Butterflies" in plant.pollinators and plant.bloom_months != '' %} 
                {% include "plants/plants_chart_modal_rows.html" %}
              {% endif %}
            {% endfor %}
          </table>
          <footer class="bnd-modal-footer">
            <p>Blooms attracting Butterflies</p>
          </footer>
        {% endwith %}
      </div>
    
      <!-- Create the modal chart - Hummingbirds -->
      <div id="hummingbirdTabContent" class="tabContent">
        {% with table_name="hummingbirdTable" %}
          <table id="hummingbirdTable" class="bnd-table">
            {% include "plants/plants_chart_modal_head.html" %}
            {% for plant in plants %}
              {% if plant.plant_show == "yes" and "Hummingbirds" in plant.pollinators and plant.bloom_months != '' %} 
                {% include "plants/plants_chart_modal_rows.html" %}
              {% endif %}
            {% endfor %}
          </table>
          <footer class="bnd-modal-footer">
            <p>Blooms attracting Hummingbirds</p>
          </footer>
        {% endwith %}
      </div>
    
    </div>
  </div>
  <!-------------------------------------------------------------------------->
{% endblock content %}

{% block js %}
  <script>
    //-----------------------------------------------------------------------------
    // Plant Table - Column Chooser Modal Script
    //----------------------------------------------------------------------------- 
    const column_chooser_url = "{% url 'plants:column_chooser' %}"
    const column_chooser_modal = document.getElementById('column_chooser_modal')
    function column_chooser() {
      // Get the column chooser html from the server
      fetch(column_chooser_url)
        .then(response => response.text())
        .then(html => {column_chooser_modal.innerHTML = html;})
      // Display the plant column chooser modal
      column_chooser_modal.style.display='block'
      // Freeze the main body while the modal is open
      document.body.classList.add("bnd-modal-open");
    }
    //-----------------------------------------------------------------------------
    // Plant Table - Column selector
    //-----------------------------------------------------------------------------
    // Get the list of columns to display
    let column_selection_safe = {{ column_selection|safe }};
    function column_selector(){
      const table = document.getElementById("plantTable");
      // 
      const column_options = ['Common Name', 'Genus/Species', 'Variety/Cultivar',
                              'Type', 'Height', 'Width', 'Bloom Color', 'Bloom Season', 'Bloom Range',
                              'Pollinators', 'CA Native', 'UCD All-Star', 'Davis Trees', 'Sunset Z14',
                              'Sun Exposure', 'Water Rqmts', 'Soil Type', 'pH Range', 
                              'Heat Tolerance', 'USDA Zones', 'Sunset Zones',
                              'Status',
      ]
      let column_index = 0;
      // determine the array index for each column
      // walk through the list of columns to either display or hide
      // AR: streamine the code via column_options.forEach()?
      let i, len;
      for (i = 0, len = column_options.length; i < len; i++) {
        if      (column_options[i] == "Common Name")      { column_index =  0; } 
        else if (column_options[i] == "Genus/Species")    { column_index =  1; }
        else if (column_options[i] == "Variety/Cultivar") { column_index =  2; }
        else if (column_options[i] == "Type")             { column_index =  3; } 
        else if (column_options[i] == "Height")           { column_index =  4; } 
        else if (column_options[i] == "Width")            { column_index =  5; } 
        else if (column_options[i] == "Bloom Color")      { column_index =  6; } 
        else if (column_options[i] == "Bloom Season")     { column_index =  7; } 
        else if (column_options[i] == "Bloom Range")      { column_index =  8; }
        else if (column_options[i] == "Pollinators")      { column_index =  9; }
        else if (column_options[i] == "CA Native")        { column_index = 10; } 
        else if (column_options[i] == "UCD All-Star")     { column_index = 11; }
        else if (column_options[i] == "Davis Trees")      { column_index = 12; }
        else if (column_options[i] == "Sunset Z14")       { column_index = 13; }
        else if (column_options[i] == "Sun Exposure")     { column_index = 14; } 
        else if (column_options[i] == "Water Rqmts")      { column_index = 15; } 
        else if (column_options[i] == "Soil Type")        { column_index = 16; }
        else if (column_options[i] == "pH Range")         { column_index = 17; }
        else if (column_options[i] == "Heat Tolerance")   { column_index = 18; }
        else if (column_options[i] == "USDA Zones")       { column_index = 19; }
        else if (column_options[i] == "Sunset Zones")     { column_index = 20; }
        else if (column_options[i] == "Status")           { column_index = 21; }
        else { console.log("ERROR: column_index not set!"); }
        // Check to see if the current column should be shown or hidden
        if (column_selection_safe.includes(column_options[i])){
          // display the column
          for (let i = 0; i < table.rows.length; i++) {
            table.rows[i].cells[column_index].style.display = "";
          }
        } else {
          // hide the column
          for (let i = 0; i < table.rows.length; i++) {
            table.rows[i].cells[column_index].style.display = "none";
          }
        }
      }
    }
    //-----------------------------------------------------------------------------
    // Search menu - sidebar navigation scripts
    //-----------------------------------------------------------------------------
    function searchOpen() {
      document.getElementById("main").style.marginLeft = "16%";
      document.getElementById("bnd-search-sidebar").classList.add("bnd-sidebar-open");
    }
    function searchClose() {
      document.getElementById("main").style.marginLeft = "0%";
      document.getElementById("bnd-search-sidebar").classList.remove("bnd-sidebar-open");
    }
    //-----------------------------------------------------------------------------
    // Search menu - Reset all search criteria to 'Any'
    //-----------------------------------------------------------------------------   
    function searchReset() {
      document.getElementById("id_type_x_search"        ).value = "Any";
      document.getElementById("id_bloom_color_search"   ).value = "Any";
      document.getElementById("id_bloom_season_search"  ).value = "Any";
      document.getElementById("id_bloom_month_search"   ).value = "Any";
      document.getElementById("id_pollinators_search"   ).value = "Any";
      document.getElementById("id_ca_native_search"     ).value = "Any";
      document.getElementById("id_ucd_all_star_search"  ).value = "Any";
      document.getElementById("id_davis_trees_search"   ).value = "Any";
      document.getElementById("id_sunset_z14_search"    ).value = "Any";
      document.getElementById("id_sun_exposure_search"  ).value = "Any";
      document.getElementById("id_water_rqmts_search"   ).value = "Any";
      document.getElementById("id_soil_type_search"     ).value = "Any";
      document.getElementById("id_pH_search"            ).value = "Any";
      document.getElementById("id_heat_tolerance_search").value = "Any";
      document.getElementById("id_usda_zone_search"     ).value = "Any";
      document.getElementById("id_sunset_zone_search"   ).value = "Any";
      document.getElementById("id_garden_search"        ).value = "Any";
      document.getElementById("id_status_search"        ).value = "Any";
    }
    //-----------------------------------------------------------------------------
    // Delete Plant Modal Script
    //-----------------------------------------------------------------------------
    const plants_delete_modal = document.getElementById('plants_delete_modal');
    function plants_delete(id) 
    {
      // The Fetch API provides a JavaScript interface for making HTTP requests and processing the responses
      url = "/plants_delete/" + id
      fetch(url)
        .then(response => response.text())
        .then(html => {plants_delete_modal.innerHTML = html;})
      // Display the plant delete modal
      plants_delete_modal.style.display='block';
      // Freeze the main body while the modal is open
      document.body.classList.add("bnd-modal-open");
    }
    //-----------------------------------------------------------------------------
    // Remove My Plant Modal Script
    //-----------------------------------------------------------------------------
    const myplant_remove_modal = document.getElementById('myplant_remove_modal')
    function myplant_remove(id)
    {
      // The Fetch API provides a JavaScript interface for making HTTP requests and processing the responses
      url = "/myplants_remove/" + id
      fetch(url)
        .then(response => response.text())
        .then(html => {myplant_remove_modal.innerHTML = html;})
      // Display the plant delete modal
      myplant_remove_modal.style.display='block'
      // Freeze the main body while the modal is open
      document.body.classList.add("bnd-modal-open");
    }
    //-----------------------------------------------------------------------------
    // Bloom Chart Modal - Open the modal
    //-----------------------------------------------------------------------------
    const plants_chart_modal = document.getElementById('plants_chart_modal')
    // Open the plant chart modal and freeze the main body while the modal is open
    function plants_chart()
    {
      plants_chart_modal.style.display='block'
      document.body.classList.add("bnd-modal-open");
    }
    //-----------------------------------------------------------------------------
    // Bloom Chart Modal - Tab switching
    //-----------------------------------------------------------------------------
    // Register each plant chart tab button and open its tab when clicked via 'openChart'
    document.getElementById("bloomTabButton"      ).addEventListener("click", function() 
    {
      openChart(event, 'bloomTabContent');
    });
    document.getElementById("beeTabButton"        ).addEventListener("click", function() 
    {
      openChart(event, 'beeTabContent');
    });
    document.getElementById("butterflyTabButton"  ).addEventListener("click", function() 
    {
      openChart(event, 'butterflyTabContent');
    });
    document.getElementById("hummingbirdTabButton").addEventListener("click", function() 
    {
      openChart(event, 'hummingbirdTabContent');
    });

    function openChart(event, selectedTabContent) 
    {
      // get each tab and the contents of each tab
      let i, tabs, tabContents;
      tabs        = document.getElementsByClassName("tab");
      tabContents = document.getElementsByClassName("tabContent");
      // Clear all tab highlighting and hide all tab content
      for (i = 0; i < tabs.length; i++)
      {
        tabs[i].classList.remove("bnd-light-green");
        tabContents[i].style.display = "none";
      }
      // Get selected tab content
      selTabContent = document.getElementById(selectedTabContent);
      // Highlight selected tab
      event.currentTarget.classList.add("bnd-light-green");
      // Show selected tab contents
      selTabContent.style.display = "block";
      // Get the table header html for the selected tab and sort the table by 
      // common name (column 0)
      table = selTabContent.firstElementChild;
      sortTable(0, table.id);
    }
    // Select the first tab - click to highlight
    bloomTab = document.getElementsByClassName("tab")[0];
    bloomTab.click();
    //-----------------------------------------------------------------------------
    // Bloom Chart Modal - color table icons - this is done on page load
    //-----------------------------------------------------------------------------
    // Get references to the various bloom tables
    const bloom_table       = document.getElementById("bloomTable");
    const bee_table         = document.getElementById("beeTable");
    const butterfly_table   = document.getElementById("butterflyTable");
    const hummingbird_table = document.getElementById("hummingbirdTable");

    function color_table_icons(table)
    {
      if (table) {
        for (let i = 0; i < table.rows.length; i++) 
        {
          const row = table.rows[i];
          if (i > 0) // skip the table header (i=0)
          {
            // Get the plants bloom color(s)
            bloom_color = row.cells[1].textContent;
            for (let j = 0; j < row.cells.length; j++) 
            {
              const cell = row.cells[j];
              if (cell.textContent == "filter_vintage")
              {
                if      (bloom_color == "white")     { cell.classList.add("bnd-text-outline");   }
                else if (bloom_color == "red")       { cell.classList.add("bnd-text-red");       }
                else if (bloom_color == "pink")      { cell.classList.add("bnd-text-pink");      }
                else if (bloom_color == "pale pink") { cell.classList.add("bnd-text-lightpink"); }
                else if (bloom_color == "orange")    { cell.classList.add("bnd-text-orange");    }
                else if (bloom_color == "yellow")    { cell.classList.add("bnd-text-yellow");    }
                else if (bloom_color == "green")     { cell.classList.add("bnd-text-green");     }
                else if (bloom_color == "cyan")      { cell.classList.add("bnd-text-cyan");      }
                else if (bloom_color == "blue")      { cell.classList.add("bnd-text-blue");      }
                else if (bloom_color == "violet")    { cell.classList.add("bnd-text-violet");    }
                else if (bloom_color == "purple")    { cell.classList.add("bnd-text-purple");    }
                else if (bloom_color == "black")     { cell.classList.add("bnd-text-black");     }
              }
            }
          }
        }
      }
    }
    //-----------------------------------------------------------------------------
    // Bloom Chart Modal - close modal
    //-----------------------------------------------------------------------------
    function plants_chart_modal_close()
    {
      document.getElementById('plants_chart_modal').style.display='none';
      document.body.classList.remove('bnd-modal-open');
    }
    //-----------------------------------------------------------------------------
    // Close the open modal if user clicks anywhere outside of the modal content
    //-----------------------------------------------------------------------------
    window.onclick = function(event) 
    {
      if (event.target == column_chooser_modal) 
      {
        column_chooser_modal.style.display = "none";
        document.body.classList.remove('bnd-modal-open');
      }
      else if (event.target == plants_chart_modal) 
      {
        plants_chart_modal.style.display = "none";
        document.body.classList.remove('bnd-modal-open');
      }
      else if (event.target == plants_delete_modal) 
      {
        plants_delete_modal.style.display = "none";
        document.body.classList.remove('bnd-modal-open');
      }
      else if (event.target == myplant_remove_modal) 
      {
        myplant_remove_modal.style.display = "none";
        document.body.classList.remove('bnd-modal-open');
      }
    }
    //-----------------------------------------------------------------------------
    // On Page load functions - modern version of windows.onload
    //-----------------------------------------------------------------------------
    document.addEventListener('DOMContentLoaded', (event) => 
    {
      sortTable(0, 'plantTable');
      column_selector();
      color_table_icons(bloom_table);
      color_table_icons(bee_table);
      color_table_icons(butterfly_table);
      color_table_icons(hummingbird_table);
    });
    //-----------------------------------------------------------------------------
  </script>
{% endblock js %}